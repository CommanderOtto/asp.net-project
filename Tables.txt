GO
IF OBJECT_ID('KBS_ADVISOR_STATUS') IS NOT NULL
  EXEC('DROP TABLE KBS_ADVISOR_STATUS')
GO
CREATE TABLE [dbo].[KBS_ADVISOR_STATUS] (
    [ASID]       INT           IDENTITY (0, 1) NOT NULL,
    [AStaDesc]   NVARCHAR(20)  NOT NULL,
    [AStaActive] INT           NOT NULL
    PRIMARY KEY CLUSTERED ([ASID] ASC)
);



GO
IF OBJECT_ID('KBS_APPOINTMENT_STATUS') IS NOT NULL
  EXEC('DROP TABLE KBS_APPOINTMENT_STATUS')
GO
CREATE TABLE [dbo].[KBS_APPOINTMENT_STATUS] (
    [STID]      INT           IDENTITY (0, 1) NOT NULL,
    [StaDesc]   NVARCHAR (20) NOT NULL,
    [StaActive] INT           NOT NULL
    PRIMARY KEY CLUSTERED ([STID] ASC)
);



GO
IF OBJECT_ID('KBS_MAJORS') IS NOT NULL
  EXEC('DROP TABLE KBS_MAJORS')
GO
CREATE TABLE [dbo].[KBS_MAJORS] (
    [MID]       INT           IDENTITY (1, 1) NOT NULL,
    [MajName]   NVARCHAR (50) NOT NULL,
    [MajActive] INT           NOT NULL
    PRIMARY KEY CLUSTERED ([MID] ASC)
);



GO
IF OBJECT_ID('KBS_REASONS') IS NOT NULL
  EXEC('DROP TABLE KBS_REASONS')
GO
CREATE TABLE [dbo].[KBS_REASONS] (
    [RID]       INT            IDENTITY (1, 1) NOT NULL,
    [ReaDesc]   NVARCHAR (150) NOT NULL,
    [ReaActive] INT            NOT NULL
    PRIMARY KEY CLUSTERED ([RID] ASC)
);



GO
IF OBJECT_ID('KBS_STUDENTS') IS NOT NULL
  EXEC('DROP TABLE KBS_STUDENTS')
GO
CREATE TABLE [dbo].[KBS_STUDENTS] (
    [SID]            INT           IDENTITY (1, 1) NOT NULL,
    [StuFName]       NVARCHAR (50) NOT NULL,
    [StuLName]       NVARCHAR (50) NOT NULL,
    [StuEmail]       NVARCHAR (80) NOT NULL,
    [StuUserName]    NVARCHAR (50) NULL,
    [StuPassword]    NVARCHAR (50) NOT NULL,
    [StuPhone]       NVARCHAR (50) NOT NULL,
    [MID]            INT           NOT NULL,
    [StuProspective] INT           DEFAULT ((0)) NOT NULL,
    [StuIUID]        NCHAR (10)    NULL,
    [StuActive]      INT           NOT NULL
    PRIMARY KEY CLUSTERED ([SID] ASC),
    CONSTRAINT [FK_KBS_STUDENTS_TO_KBS_MAJORS] FOREIGN KEY ([MID]) REFERENCES [dbo].[KBS_MAJORS] ([MID])
);
GO
CREATE UNIQUE NONCLUSTERED INDEX [UNIQUE_UID_EXCEPT_NULL]
    ON [dbo].[KBS_STUDENTS]([StuIUID] ASC) WHERE ([StuIUID] IS NOT NULL);



GO
IF OBJECT_ID('KBS_ADVISORS') IS NOT NULL
  EXEC('DROP TABLE KBS_ADVISORS')
GO
CREATE TABLE [dbo].[KBS_ADVISORS] (
    [AID]         INT           IDENTITY (1, 1) NOT NULL,
    [AdvFName]    NVARCHAR (50) NOT NULL,
    [AdvLName]    NVARCHAR (50) NOT NULL,
    [AdvUserName] NVARCHAR (25) NOT NULL,
    [AdvPassword] NVARCHAR (50) NOT NULL,
    [AdvStatus]   INT           NOT NULL,
    [AdvActive]   INT           NOT NULL
    PRIMARY KEY CLUSTERED ([AID] ASC)
);



GO
IF OBJECT_ID('KBS_ADVISOR_TIMES') IS NOT NULL
  EXEC('DROP TABLE KBS_ADVISOR_TIMES')
GO
CREATE TABLE [dbo].[KBS_ADVISOR_TIMES] (
    [ATID]    INT      IDENTITY (1, 1) NOT NULL,
    [AvaDate] DATE     NOT NULL,
    [AvaTime] TIME     NOT NULL,
    [AID]     INT      NOT NULL,
    [Valid]   INT  DEFAULT ((0)) NULL,
    PRIMARY KEY CLUSTERED ([ATID] ASC), 
    CONSTRAINT [FK_KBS_ADVISOR_TIMES_TO_ADVISOR] FOREIGN KEY ([AID]) REFERENCES [KBS_ADVISORS]([AID])
);
GO
CREATE UNIQUE NONCLUSTERED INDEX [ADVISOR_TIMES_DATE_TIME_AID_UNIQUE_COMBINAITION]
    ON [dbo].[KBS_ADVISOR_TIMES]([AID] ASC, [AvaTime] ASC, [AvaDate] ASC);




GO
IF OBJECT_ID('KBS_APPOINTMENTS') IS NOT NULL
  EXEC('DROP TABLE KBS_APPOINTMENTS')
GO
CREATE TABLE [dbo].[KBS_APPOINTMENTS] (
    [APID]   INT            IDENTITY (1, 1) NOT NULL,
    [ATID]   INT            NULL,
    [SID]    INT            NOT NULL,
    [Status] INT            DEFAULT ((0)) NOT NULL,
    [Notes]  NVARCHAR (200) NULL,
    PRIMARY KEY CLUSTERED ([APID] ASC),
    CONSTRAINT [FK_KBS_APPOINTMENTS_TO_KBS_APPOINTMENT_STATUS] FOREIGN KEY ([Status]) REFERENCES [dbo].[KBS_APPOINTMENT_STATUS] ([STID]),
    CONSTRAINT [FK_KBS_APPOINTMENTS_TO_KBS_ADVISOR_TIMES] FOREIGN KEY ([ATID]) REFERENCES [dbo].[KBS_ADVISOR_TIMES] ([ATID]),
    CONSTRAINT [FK_KBS_APPOINTMENTS_TO_KBS_STUDENTS] FOREIGN KEY ([SID]) REFERENCES [dbo].[KBS_STUDENTS] ([SID])
);
GO
CREATE UNIQUE NONCLUSTERED INDEX [UNIQUE_APPOINTMENTDT_EXCEPT_NULL]
    ON [dbo].[KBS_APPOINTMENTS]([ATID] ASC) WHERE ([ATID] IS NOT NULL);



GO
IF OBJECT_ID('KBS_REASON_LOOKUP') IS NOT NULL
  EXEC('DROP TABLE KBS_REASON_LOOKUP')
GO
CREATE TABLE [dbo].[KBS_REASON_LOOKUP] (
    [RID]  INT NOT NULL,
    [APID] INT NOT NULL,
    PRIMARY KEY CLUSTERED ([RID] ASC, [APID] ASC), 
    CONSTRAINT [FK_KBS_REASON_LOOKUP_TO_REASONS] FOREIGN KEY ([RID]) REFERENCES [KBS_REASONS]([RID]), 
    CONSTRAINT [FK_KBS_REASON_LOOKUP_TO_APPOINTMENT] FOREIGN KEY ([APID]) REFERENCES [KBS_APPOINTMENTS]([APID])
);
